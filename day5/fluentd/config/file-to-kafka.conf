<source>
    @type tail
    @log_level info
    path /fluentd/source/movies.txt
    pos_file /fluentd/source/movies.pos
    refresh_interval 5
    multiline_flush_interval 5
    rotate_wait 5
    open_on_every_update true
    emit_unmatched_lines true
    read_from_head true
    tag movies.info
    <parse>
        @type tsv
        keys movie,title,title_eng,year,grade
        types movie:string,title:string,title_eng:string,year:integer,grade:string
    </parse>
</source>

<match movies.info>
    @type kafka2

    brokers kafka:9093
    use_event_time true

    <buffer topic>
        @type file
        path /var/log/td-agent/buffer/td
        flush_interval 3s
    </buffer>

    <format>
        @type json
    </format>

    default_topic movies
    required_acks -1
    compression_codec gzip
</match>

<match movies.debug>
    @type stdout
    @log_level debug
</match>

